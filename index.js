/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const fs = require('fs'), path = require('path');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const Discord = require('discord.js'), client = new Discord.Client({partials: ["MESSAGE", "CHANNEL", "REACTION"]});

client.realCommands = new Discord.Collection();
client.commands = new Discord.Collection();

client.config = {
  DEFAULT_PREFIX: "a."
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

client.dashboardURL = "https://abbycastle-git-preview.vercel.app/";
client.db = require('./utils/database');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

client.underDevelopment = false;

const server = require('./server');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const handlers = require('./utils/handlers');

handlers.loadEvents(client);

handlers.loadCommands(client);

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function start() {
  client.login((!client['underDevelopment']) ? process.env.TOKEN : process.env.TEST_TOKEN);

  client.on('ready', () => {
    server.setClient(client);
  });
}

try {
  start();
} catch (err) {
  throw err;
}

process.on('beforeExit', () => {
  client && client.destroy ? client.destroy() : null;
})